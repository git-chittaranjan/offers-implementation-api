GetOfferResponse
===================================================
{
    "cust_fed_id": "9283746150",
    "placeholder_guid": "55C5AA3B-AB8B-F011-9F57-64D69AE7FAE4",
    "placeholder_name": "Offer For You",
    "channel_name": "NLI",
    "channel_type": "Web",
    "placeholder_offer_limit": 2,
    "placeholder_meta": "{\"service_type\":\"Retail\",\"placeholder_description\":\"\"}",
    "offer_data": [
        {
            "offer_guid": "5D108C19-5487-F011-9F57-64D69AE7FAE4",
            "offer_name": "Personal Loan Asset Offer",
            "offer_description": "Offer Description",
            "offer_type": "NBA",
            "offer_priority": 2,
            "offer_view_threshold": 10,
            "offer_click_threshold": 3,
            "offer_banner_type": "Static",
            "offer_content": "{ \"redirection_URL\": \"https://www.chittaranjansaha.com\", \"image_URL\": { \"mobile\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/Personal_Loan_Asset_Offer.gif\", \"desktop\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/Personal_Loan_Asset_Offer.gif\", \"tablet\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/Personal_Loan_Asset_Offer.gif\" }, \"offer_text\": \"Personal Loan Asset Offer\" }",
            "offer_extra_content": "",
            "offer_meta": "{\"product\":\"PL\"}"
        },
        {
            "offer_guid": "F7E26247-5587-F011-9F57-64D69AE7FAE4",
            "offer_name": "Credit Card Upgrade Offer",
            "offer_description": "Offer Description",
            "offer_type": "NBA",
            "offer_priority": 4,
            "offer_view_threshold": 10,
            "offer_click_threshold": 3,
            "offer_banner_type": "Static",
            "offer_content": "{ \"redirection_URL\": \"https://www.chittaranjansaha.com\", \"image_URL\": { \"mobile\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/Credit_Card_Upgrade_Offer.gif\", \"desktop\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/Credit_Card_Upgrade_Offer.gif\", \"tablet\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/Credit_Card_Upgrade_Offer.gif\" }, \"offer_text\": \"Credit Card Upgrade Offer\" }",
            "offer_extra_content": "",
            "offer_meta": "{\"product\":\"CC\"}"
        },
        {
            "offer_guid": "F9E26247-5587-F011-9F57-64D69AE7FAE4",
            "offer_name": "Scan & Pay Offer",
            "offer_description": "Offer Description",
            "offer_type": "NBA",
            "offer_priority": 6,
            "offer_view_threshold": 10,
            "offer_click_threshold": 3,
            "offer_banner_type": "Static",
            "offer_content": "{ \"redirection_URL\": \"https://www.chittaranjansaha.com\", \"image_URL\": { \"mobile\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/Scan_&_Pay_Offer.gif\", \"desktop\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/Scan_&_Pay_Offer.gif\", \"tablet\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/Scan_&_Pay_Offer.gif\" }, \"offer_text\": \"Scan & Pay Offer\" }",
            "offer_extra_content": "",
            "offer_meta": "{\"product\":\"SP\"}"
        },
        {
            "offer_guid": "FBE26247-5587-F011-9F57-64D69AE7FAE4",
            "offer_name": "Pay to Contact Offer",
            "offer_description": "Offer Description",
            "offer_type": "NBA",
            "offer_priority": 8,
            "offer_view_threshold": 10,
            "offer_click_threshold": 3,
            "offer_banner_type": "Static",
            "offer_content": "{ \"redirection_URL\": \"https://www.chittaranjansaha.com\", \"image_URL\": { \"mobile\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/Pay_to_Contact_Offer.gif\", \"desktop\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/Pay_to_Contact_Offer.gif\", \"tablet\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/Pay_to_Contact_Offer.gif\" }, \"offer_text\": \"Pay to Contact Offer\" }",
            "offer_extra_content": "",
            "offer_meta": "{\"product\":\"PC\"}"
        },
        {
            "offer_guid": "FDE26247-5587-F011-9F57-64D69AE7FAE4",
            "offer_name": "iWish Offer",
            "offer_description": "Offer Description",
            "offer_type": "NBA",
            "offer_priority": 10,
            "offer_view_threshold": 10,
            "offer_click_threshold": 3,
            "offer_banner_type": "Static",
            "offer_content": "{ \"redirection_URL\": \"https://www.chittaranjansaha.com\", \"image_URL\": { \"mobile\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/iWish_Offer.gif\", \"desktop\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/iWish_Offer.gif\", \"tablet\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/iWish_Offer.gif\" }, \"offer_text\": \"iWish Offer\" }",
            "offer_extra_content": "",
            "offer_meta": "{\"product\":\"iWish\"}"
        },
        {
            "offer_guid": "FFE26247-5587-F011-9F57-64D69AE7FAE4",
            "offer_name": "Fastag Offer",
            "offer_description": "Offer Description",
            "offer_type": "NBA",
            "offer_priority": 12,
            "offer_view_threshold": 10,
            "offer_click_threshold": 3,
            "offer_banner_type": "Static",
            "offer_content": "{ \"redirection_URL\": \"https://www.chittaranjansaha.com\", \"image_URL\": { \"mobile\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/Fastag_Offer.gif\", \"desktop\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/Fastag_Offer.gif\", \"tablet\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/Fastag_Offer.gif\" }, \"offer_text\": \"Fastag Offer\" }",
            "offer_extra_content": "",
            "offer_meta": "{\"product\":\"Fastag\"}"
        },
        {
            "offer_guid": "1ECB7B32-5687-F011-9F57-64D69AE7FAE4",
            "offer_name": "Electricity Billpay Offer",
            "offer_description": "Offer Description",
            "offer_type": "NBA",
            "offer_priority": 14,
            "offer_view_threshold": 10,
            "offer_click_threshold": 3,
            "offer_banner_type": "Static",
            "offer_content": "{ \"redirection_URL\": \"https://www.chittaranjansaha.com\", \"image_URL\": { \"mobile\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/Electricity_Billpay_Offer.gif\", \"desktop\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/Electricity_Billpay_Offer.gif\", \"tablet\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/Electricity_Billpay_Offer.gif\" }, \"offer_text\": \"Electricity Billpay Offer\" }",
            "offer_extra_content": "",
            "offer_meta": "{\"product\":\"BBPS\"}"
        },
        {
            "offer_guid": "20CB7B32-5687-F011-9F57-64D69AE7FAE4",
            "offer_name": "Consumer EMI Offer",
            "offer_description": "Offer Description",
            "offer_type": "NBA",
            "offer_priority": 16,
            "offer_view_threshold": 10,
            "offer_click_threshold": 3,
            "offer_banner_type": "Static",
            "offer_content": "{ \"redirection_URL\": \"https://www.chittaranjansaha.com\", \"image_URL\": { \"mobile\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/Consumer_EMI_Offer.gif\", \"desktop\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/Consumer_EMI_Offer.gif\", \"tablet\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/Consumer_EMI_Offer.gif\" }, \"offer_text\": \"Consumer EMI Offer\" }",
            "offer_extra_content": "",
            "offer_meta": "{\"product\":\"EMI\"}"
        },
        {
            "offer_guid": "22CB7B32-5687-F011-9F57-64D69AE7FAE4",
            "offer_name": "Debit Card Upgrade Offer",
            "offer_description": "Offer Description",
            "offer_type": "NBA",
            "offer_priority": 18,
            "offer_view_threshold": 10,
            "offer_click_threshold": 3,
            "offer_banner_type": "Static",
            "offer_content": "{ \"redirection_URL\": \"https://www.chittaranjansaha.com\", \"image_URL\": { \"mobile\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/Debit_Card_Upgrade_Offer.gif\", \"desktop\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/Debit_Card_Upgrade_Offer.gif\", \"tablet\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/Debit_Card_Upgrade_Offer.gif\" }, \"offer_text\": \"Debit Card Upgrade Offer\" }",
            "offer_extra_content": "",
            "offer_meta": "{\"product\":\"DCU\"}"
        },
        {
            "offer_guid": "24CB7B32-5687-F011-9F57-64D69AE7FAE4",
            "offer_name": "Demat Default Offer",
            "offer_description": "Offer Description",
            "offer_type": "Default",
            "offer_priority": 20,
            "offer_banner_type": "Static",
            "offer_content": "{ \"redirection_URL\": \"https://www.chittaranjansaha.com\", \"image_URL\": { \"mobile\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/Demat_Default_Offer.gif\", \"desktop\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/Demat_Default_Offer.gif\", \"tablet\": \"https://raw.githubusercontent.com/git-chittaranjan/offers-implementation-api/main/Frontend/Contents/Desktop/Demat_Default_Offer.gif\" }, \"offer_text\": \"Demat_Default_Offer.gif\" }",
            "offer_extra_content": "",
            "offer_meta": "{\"product\":\"Demat\"}"
        }
    ]
}




Test cases
===================================================
1. Check if customer exists/valid/active - Function defined (fn_IsCustomerValid)
2. Check if placeholder exists/valid/active - Function defined (fn_IsPlaceholderValid)
3. Check for active flag for offer - Checked while selecting offers (Offer_Visibility_Flag = 1)
4. Check for empty offer - No offers means placeholder details along with empty offer array [] will be returned
5. Placeholder default offer handling - Handled with UNION
6. Apply placeholder offer limit - Not Handled
7. Offer Viewed and Offer clicked are less than the threshold - Implemented with Trigger
8. Counter will count for last three days - Implemented logic while fetching offers




APIs to be developed
=======================================================
GetAllCustomers
GetCustomerDetails
AddCustomer
UpdateCustomer
DeleteCustomer

GetAllCustomers
GetCustomerDetails
AddCustomer
UpdateCustomer
DeleteCustomer

GetAllCustomers
GetCustomerDetails
AddCustomer
UpdateCustomer
DeleteCustomer

GetAllCustomers
GetCustomerDetails
AddCustomer
UpdateCustomer
DeleteCustomer



GPT Prompt
=======================================================

I want to get below JSON from API response. Where I will pass cust_fed_id and placeholder_guid in the API url. 

1. Customer → customer master data
2. Placeholder → defines where offers appear (app section, banner, etc.)
3. Offers → master offer data
4. CustomerOffers → which customers are eligible for which offers (many-to-many)
5. PlaceholderOffer → which offers can appear in which placeholder (many-to-many)
6. Bits → logs customer actions (views/clicks)

Provide me the store procedure and ASP.NET core web API code to implement it. I want complete implementation.
Where placeholder_meta, offer_content, offer_extra_content and offer_meta are stored in a single column in JSON format


public class CustomerOffersResponse
{
    public string cust_fed_id { get; set; }
    public string placeholder_guid { get; set; }
    public string placeholder_name { get; set; }
    public string channel_name { get; set; }
    public string channel_type { get; set; }
    public int placeholder_offer_limit { get; set; }
    public PlaceholderMeta placeholder_meta { get; set; }
    public List<OfferData> offer_data { get; set; }
}

public class PlaceholderMeta
{
    public string created_by { get; set; }
    public string created_on { get; set; }
    public string last_updated { get; set; }
}

public class OfferData
{
    public string offer_guid { get; set; }
    public string offer_name { get; set; }
    public string offer_description { get; set; }
    public string offer_type { get; set; }
    public int offer_priority { get; set; }
    public int offer_view_threshold { get; set; }
    public int offer_click_threshold { get; set; }
    public string offer_banner_type { get; set; }
    public JsonElement offer_content { get; set; }
    public JsonElement offer_extra_content { get; set; }
    public JsonElement offer_meta { get; set; }
}




[ApiController]
[Route("api/[controller]")]
public class OffersController : ControllerBase
{
    private readonly IConfiguration _config;

    public OffersController(IConfiguration config)
    {
        _config = config;
    }

    [HttpGet("{cust_fed_id}/{placeholder_guid}")]
    public async Task<IActionResult> GetCustomerOffers(string cust_fed_id, Guid placeholder_guid)
    {
        string connStr = _config.GetConnectionString("DefaultConnection");
        using var conn = new SqlConnection(connStr);
        using var cmd = new SqlCommand("usp_GetCustomerPlaceHolderOffers", conn);
        cmd.CommandType = CommandType.StoredProcedure;
        cmd.Parameters.AddWithValue("@cust_fed_id", cust_fed_id);
        cmd.Parameters.AddWithValue("@placeholder_guid", placeholder_guid);

        await conn.OpenAsync();
        var jsonResult = "";

        using (var reader = await cmd.ExecuteReaderAsync())
        {
            while (await reader.ReadAsync())
            {
                jsonResult += reader.GetString(0);
            }
        }

        // Deserialize JSON, return typed C# object
        var response = System.Text.Json.JsonSerializer.Deserialize<CustomerOffersResponse>(jsonResult);
        return Ok(response);
    }
}









